(()=>{"use strict";const t="boostSDAnalytics",e="boostSDSessionId",o={VIEW_PRODUCT:"view_product",QUICK_VIEW:"quick_view",ADD_TO_CART:"add_to_cart",BUY_NOW:"buy_now"},r="filter",n="search",c="suggest",s="recommend",i="boostSDRequestIdProductClickedKey",a="boostSDRecommendationActiveKey",l="boost-sd__",d=`.${l}suggestion-queries-item--product`,u=`.${l}product-item, .${l}product-item-list-view-layout`,g=`.${l}recommendation`,p=`.${l}btn-quick-view`,f=`.${l}btn-add-to-cart, form[action="/cart/add"] *[type="submit"], form[action="/cart/add"] *[name="add"]`,b=`.${l}btn-buy-now, .shopify-payment-button, #dynamic-checkout-cart`,m=`.${l}quick-view`;function y(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function S(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})))),r.forEach((function(e){y(t,e,o[e])}))}return t}var _,h,O="";const D=localStorage.getItem(e);var I,v=D?null===(_=D)||void 0===_?void 0:_.replaceAll('"',""):"";D&&(null===(h=D)||void 0===h?void 0:h.includes(""))&&localStorage.setItem(e,null===(I=D)||void 0===I?void 0:I.replaceAll('"',""));const x=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),A=t=>{try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(t){return null}},k=(t,e)=>{try{null!=e?localStorage.setItem(t,JSON.stringify(e)):localStorage.setItem(t,"")}catch(t){}},w=()=>"collection"===boostSDAppConfig?.generalSettings?.page,C=()=>"search"===boostSDAppConfig?.generalSettings?.page,T=()=>"product"===boostSDAppConfig?.generalSettings?.page,R=()=>{let t="";switch(!0){case w():t="collection_page";break;case C():t="search_page";break;case T():t="product_page";break;case"cart"===boostSDAppConfig?.generalSettings?.page:t="cart_page";break;case"index"===boostSDAppConfig?.generalSettings?.page:t="home_page"}return t},q=(t,l,d,u={})=>{let g=u?.rid?u?.rid:((t,e)=>{let o="";switch(e){case r:o="boostSDRequestIdFilterKey";break;case n:o="boostSDRequestIdSearchKey";break;case c:o="boostSDRequestIdSuggestKey";break;case s:o="boostSDRequestIdRecommendationKey"}if(!o)return"";if(e===s){const e=A(a);if(e&&e.pid===t)return e.rid}const i=A(o);if(i){const e=Object.keys(i);for(let o=0;o<e.length;o++)if(i[e[o]]?.includes(Number(t)))return e[o]}return""})(t,d);if(d){const e=((t,e=50)=>{let o=A(t)||{};if(Object.keys(o).length>=e){const t={},r=Object.keys(o),n=Object.values(o);for(let o=0;o<e;o++)t[r[o]]=n[o];o=t}return o})(i,3),o=S({[Number(t)]:g},e);k(i,o)}if(!d||!g){const e=A(i);if(!e||!e[Number(t)])return!1;g=e[Number(t)]}const p=(t=>{const e=A("boostSDRequestIdSaveInfoRequest");return e&&e[t]?e[t]?.query_string:""})(g);l===o.QUICK_VIEW&&(l=o.VIEW_PRODUCT);const f=O;return S({tid:Shopify.shop,qs:p,eid:x(),rid:g,ct:f||localStorage.getItem("cartToken"),pid:t,t:(new Date).toISOString(),u:l,a:d||"other",r:document.referrer,sid:v||(v=x(),localStorage.setItem(e,v),v),cid:__st?.id||meta?.page?.customerId||ShopifyAnalytics?.meta?.page?.customerId||ShopifyAnalytics?.lib?.user()?.traits()?.uniqToken,pg:R()},u)},j=e=>{var o=A(t);Array.isArray(o)||(o=[]);const r=o.filter((t=>t.pid!=e.productId));r.push(e),k(t,r)};const E=(e,o)=>{const r=window.boostSDAppConfig?.api?.analyticsUrl||"https://lambda.mybcapps.com/e";if("recommend"===e.a&&["add_to_cart","buy_now"].includes(e.u)&&localStorage.removeItem(a),o)return setTimeout((()=>{return t=e,void fetch("/cart.js").then((t=>t.json())).then((e=>{const o=e.token;O=o,o&&localStorage.setItem("cartToken",o),t&&(t.ct=o,E(t,!1))})).catch((e=>{E(t,!1),console.log("error call refresh cartToken, send tracking without cart token",e)}));var t}),1200);(async function(t="",e={}){return(await fetch(t,{method:"POST",body:JSON.stringify(e)})).json()})(r,e).then((o=>{(o.error="")&&(e=>{var o=A(t);if(Array.isArray(o)){var r=o.filter((t=>t.pid!=e));k(t,r)}})(e.pid)}))},N=t=>{if(!t||!t.target)return;if("keydown"==t.type&&"Enter"!==t.key)return;const e=t.target.closest(d);if(!e)return;const r=e.getAttribute("data-id");if(!r)return;const n=q(r,o.VIEW_PRODUCT,c);j(n),E(n)};(t=>{if(!t)return null;console.log("register event initInstantSearch"),document.addEventListener("click",N,!0),document.addEventListener("keydown",N,!0)})(!0);const U=t=>{if(!t||!t.target)return;const e=t.target;let c=C()?n:w?r:s;if(e.closest(g)&&(c=s),c!==s&&T())return;let i=o.VIEW_PRODUCT;e.closest(p)?i=o.QUICK_VIEW:e.closest(b)?i=o.BUY_NOW:e.closest(f)&&(i=o.ADD_TO_CART);let l="";const d=e.closest(u);if(d?l=d.getAttribute("id")||"":i!=o.ADD_TO_CART&&i!=o.BUY_NOW||(l=e.closest(m)?.getAttribute("product-id")),!l)return;if(e.closest(m)){const t=A(a);t&&l===t.pid&&(c=s)}const y={};if(c===s){const t=e.closest(g),o=t?.parentNode;if(o?.id){const t=o.id?.replace("boost-sd-widget-",""),e=o.classList[0]?.replace("boost-sd-","");y.wid=t,y.rt=e;const r=A("boostSDRequestIdMoreInformationKey");if(Object.keys(r)?.length>0){const e=Object.keys(r).find((e=>r[e].wid===t));!y.rt&&r[e]&&(y.rt=r[e]?.rt),y.rid=e,k(a,{rid:e,wid:y.wid,rt:y.rt,pid:l})}}}if(T()&&[o.ADD_TO_CART,o.BUY_NOW].includes(i))return;const S=q(l,i,c,y);j(S),E(S,[o.ADD_TO_CART,o.BUY_NOW].includes(i))};console.log("register event initCollectionSearchPage"),document.addEventListener("click",U,!0);const W=t=>{if(!t||!t.target)return;const e=t.target,r=e.closest(b);if(e.closest(f)||r){let t={pid:boostSDAppConfig?.generalSettings?.product_id?.toString(),u:r?o.BUY_NOW:o.ADD_TO_CART},n="";const c=e.closest(g);if(c){const e=c.parentElement?.id;e&&(n="recommend",t.wid=e.replace("boost-sd-widget-",""))}const s=e.closest(m);if(s){const e=s.getAttribute("product-id");e&&(t.pid=e,n="recommend")}if(t=q(t.pid,t.u,n,t),!t)return;j(t),E(t,!0)}};T()&&(console.log("register event initOtherPage"),document.addEventListener("click",W,!0))})();